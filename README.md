# seckilling
用python+redis+rabbitmq搭建一个简单的秒杀系统。由于是从项目中抽离出来的一个部分，所以省略了其他业务功能接口，只包含秒杀系统相关程序。



## 基础流程、架构

### 基础预设

0. mysql中存储商品信息、订单信息

1. redis存入商品信息、设置计数器、存储成功订单的数据结构等
2. rabbitmq创建队列
   - 订单队列
   - 支付延迟队列



### 基础架构

**注：服务异步拆分，减少耦合，加快响应。（rabbitmq）**

避免同步的执行：请求→订单→支付→修改库存→结束返回。

1. 用户提交订单

   - 通过redis计数器筛选

   - 成功则返回标识，然后入订单队列 + 超时队列
     - 标识与用户信息写入redis，用于后续验证支付
     - 订单队列，mysql监听，写入mysql的订单历史表
     - 超时订单队列有计时功能，一定时间内未支付，订单失效，抢购失败。写入redis（标志失败）
   - 失败直接返回
   - 订单服务结束

2. 用户支付订单

   - 验证订单以及检查是否已超时（是否已在redis相关结构内）

   - 成功支付则入支付队列
     - mysql监听这个队列，执行库存同步操作。
     - 写入redis
   - 失败或超时直接返回
   - 支付服务结束



### 基本流程

1. 用户发起抢购请求
   - 小于计数器则成功返回一个唯一标识（uuid或时间戳）
   - 大于计数器直接返回抢购结束
2. 用户拿到标识后，转向支付接口
   - 订单进入支付延迟队列，超时未支付则抢购失败
   - 支付成功的订单导入redis
   - 从支付延迟队列弹出的信息先查看redis成功订单，若不存在，则告知用户 支付失败
3. 待活动结束后，从redis导出订单，同步到mysql中。









系统详解：博客





